<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>STM32F4-3DSound - 3D Sound Effect on STM32F4-Discovery Board</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>STM32F4-3DSound</h1>
        <p>3D sound effect on stm32f4</p>

        <p class="view"><a href="https://github.com/cahya-wirawan/stm32f4-3dsound">View the Project on GitHub <small>cahya-wirawan/stm32f4-3dsound</small></a></p>


        <ul>
          <li><a href="https://github.com/cahya-wirawan/stm32f4-3dsound/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://cahya-wirawan.github.io/stm32f4-3dsound/download/stm32f4-3dsound-0.3.bin.zip">Download <strong>Compiled Binary</strong></a></li>
          <li><a href="https://github.com/cahya-wirawan/stm32f4-3dsound">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a id="main-title" class="anchor" href="#main-title" aria-hidden="true"><span class="octicon octicon-link"></span></a>STM32F4-3DSound</h3>

<p>
  STM32F4-3DSound is an application that runs on a STM32F4-Discovery board for playing a waveform file with 
  3D sound effects. It reads a mono sound waveform file from a USB stick, and processes the sound samples in 
  real-time to produce a three-dimensional sound effect, then sends the output to stereo headphones. 
  The 3D sound effect is controlled by the spatial alignment of the board, which uses the MEMS motion sensor to determine its 
  position. The board can be rotated to the left, right, up and bottom, which will change the direction of the sound source.
  The rotation of the horizontal angle (azimuth) is limited from -90&deg; (left) to 90&deg; (right), and vertical angle (elevation) 
  from -40&deg; to 90&deg;. 
</p>
<img src="pictures/stm32f4-02.jpg" alt="STM32F4-Discovery board" style="width:400px;height:300px">
<p>
  The application plays a waveform file from the root directory of a USB stick in a loop until the blue button 
  is pressed, which plays the next waveform file. Only a mono sound file with sample rate of 44100 Hz will be 
  accepted by the application, and headphones should be used to get the best result. Optionally, a serial 
  connection (USART with TX=pin PA2, 115200 baud, 8N1) can be used to monitor the application (error messages, 
  information about the waveform file to play, the angle position of the board, etc).
</p>
<p>
  The sound effect is achieved using a technology called Head Related Transfer Function (HRTF), which introduces
  true 3D sound spatialisation using headphones. Citation from Wikipedia: <i>“A head-related transfer function (HRTF)
  is a response that characterises how an ear receives a sound from a point in space; a pair of HRTFs for two ears 
  can be used to synthesise a binaural sound that seems to come from a particular point in space. It is a transfer 
  function, describing how a sound from a specific point will arrive at the ear (generally at the outer end of the 
  auditory canal)”</i>.
</p>
<p> HRTF measurement is a time consuming and complex procedure that is performed with expensive equipment in an anechoic chamber. Some universities made HRTF measurement and publish it's result. For this application I use the HRTF measurements of
a <a href="http://sound.media.mit.edu/resources/KEMAR.html">KEMAR dummy head microphone from MIT Media Lab</a> and the HRTF
measurements of <a href="http://www.cis.pku.edu.cn/auditory/Staff/Dr.Qu.files/Qu-HRTF-Database.html">Key Lab of Machine Perception (Ministry of Education), Peking University</a>.
</p>
<p>
  3D sound spatialisation is <a href="http://blog.codinghorror.com/3d-positional-audio-and-hrtfs/">a computationally expensive algorithm</a>, but nevertheless, a small inexpensive 
  development board like STM32F4-Discovery with only 168 MHz cpu power and 192 KB RAM still has enough power to do 
  all this HRTF calculation in real-time.
</p>
<p>
  Oculus Rift recently announced at CES 2015 that they will support HRTF technology in their upcoming Oculus Audio 
  SDK. If you don’t have Oculus, but want to try out 3D sound spatialisation with HRTF, then just try this 
  application on your STM32F4-Discovery board, you will not be disappointed :)
</p>

<h3>Usage:</h3>
<pre><code>
  $ git clone git@github.com:cahya-wirawan/stm32f4-3dsound.git
  $ cd stm32f4-3dsound
  $ make
</code></pre>

<p>
  The binary (stm32f4-3dsound.bin, .hex, .elf) will be created in the build/ sub-directory.
  A <a href="https://cahya-wirawan.github.io/stm32f4-3dsound/download/stm32f4-3dsound-0.3.bin.zip">pre-compiled binary</a> (version 0.3) can also be downloaded from this website.
</p>

<p>There are four HRTF databases currently included in the source code. This database can be selected in cwHrtfArray.h:</p>
<ol>
    <li><dt>CW_HRTF_KEMAR_COMPLETE</dt></li>
  <dl>
    This is the original Kemar HRTF measurement including the measurement system response and the ear canal response. The HRTFs were measured at distance of 140 cm.
  </dl>
    <li><dt>CW_HRTF_KEMAR_DIFFUSE</dt></li>
  <dl>
    This is the Kemar HRTF measurement, where the measurement
system response and the ear canal response are removed from the database. The HRTFs were measured at distance of 140 cm.<br>
  </dl>
    <li><dt>CW_HRTF_PKU_IOA_20</dt></li>
  <dl>
    This is the HRTF measurement of Key Lab of Machine Perception (Ministry of Education), Peking University. The HRTFs were measured at distance of 20 cm<br>
  </dl>
  <li><dt>CW_HRTF_PKU_IOA_130</dt></li>
  <dl>
    This is the HRTF measurement of Key Lab of Machine Perception (Ministry of Education), Peking University. The HRTFs were measured at distance of 130 cm.
  </dl>
</ol>

<i>Note: The sample rate of HRTF measurement from Peking University is 65.536 Hz, but this application uses sample rate of 44.100 Hz, therefore this HRTF measurement was resampled to 44.100 Hz</i>
</section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/cahya-wirawan">cahya-wirawan</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59648141-3', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
